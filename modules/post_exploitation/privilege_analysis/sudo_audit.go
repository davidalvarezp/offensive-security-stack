package privilege_analysis

import (
	"github.com/davidalvarezp/offensive-security-stack/internal/core"
	"github.com/davidalvarezp/offensive-security-stack/internal/reporting"
)

type SudoAudit struct {
	Reporter *reporting.ReportManager
}

func NewSudoAudit(r *reporting.ReportManager) *SudoAudit {
	return &SudoAudit{Reporter: r}
}

func (m *SudoAudit) Name() string {
	return "postex-sudo-audit"
}

func (m *SudoAudit) Description() string {
	return "Audits sudo rules for privilege escalation risk"
}

func (m *SudoAudit) Run(ctx *core.AppContext) error {
	report := `
Sudo Audit:
- user bob â†’ ALL=(ALL) NOPASSWD
- script execution allowed without restriction
- Risk: privilege escalation
`
	m.Reporter.AddReport("Sudo Audit", m.Name(), report)
	ctx.Logger.Warn("Sudo configuration reviewed (simulation)")
	return nil
}
