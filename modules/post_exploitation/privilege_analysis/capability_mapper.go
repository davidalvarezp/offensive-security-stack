package privilege_analysis

import (
	"github.com/davidalvarezp/offensive-security-stack/internal/core"
	"github.com/davidalvarezp/offensive-security-stack/internal/reporting"
)

type CapabilityMapper struct {
	Reporter *reporting.ReportManager
}

func NewCapabilityMapper(r *reporting.ReportManager) *CapabilityMapper {
	return &CapabilityMapper{Reporter: r}
}

func (m *CapabilityMapper) Name() string {
	return "postex-capability-mapper"
}

func (m *CapabilityMapper) Description() string {
	return "Maps Linux capabilities assigned to processes (simulated)"
}

func (m *CapabilityMapper) Run(ctx *core.AppContext) error {
	report := `
Capability Mapping:
- cap_net_bind_service → web server
- cap_sys_admin → container runtime
- Risk: excessive capabilities
`
	m.Reporter.AddReport("Capability Mapping", m.Name(), report)
	ctx.Logger.Warn("Linux capabilities reviewed (simulation)")
	return nil
}
