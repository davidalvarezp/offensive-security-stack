package lateral_movement

import (
	"github.com/davidalvarezp/offensive-security-stack/internal/core"
	"github.com/davidalvarezp/offensive-security-stack/internal/reporting"
)

type CredentialFlow struct {
	Reporter *reporting.ReportManager
}

func NewCredentialFlow(r *reporting.ReportManager) *CredentialFlow {
	return &CredentialFlow{Reporter: r}
}

func (m *CredentialFlow) Name() string {
	return "postex-credential-flow"
}

func (m *CredentialFlow) Description() string {
	return "Analyzes simulated credential reuse and movement paths"
}

func (m *CredentialFlow) Run(ctx *core.AppContext) error {
	report := `
Credential Flow Analysis (Simulated):
- User: alice â†’ reused on host-b
- Service account: svc_backup shared across 3 systems
- Risk: lateral movement via credential reuse
`
	m.Reporter.AddReport("Credential Flow", m.Name(), report)
	ctx.Logger.Warn("Credential reuse paths analyzed (simulation)")
	return nil
}
